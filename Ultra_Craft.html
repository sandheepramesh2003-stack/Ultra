<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultracraft</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            touch-action: none; /* Prevents scrolling on touch devices */
        }
        .element {
            cursor: grab;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            user-select: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .sidebar-element {
            width: 75px;
            height: 75px;
        }
        .sidebar-element .text-3xl { font-size: 1.5rem; } /* Smaller emoji */
        .sidebar-element .text-sm { font-size: 0.75rem; } /* Smaller text */

        .crafting-element {
            width: 90px;
            height: 90px;
            position: absolute;
            transition: left 0.1s linear, top 0.1s linear; /* Smooth nudge */
        }
        .element:hover {
            transform: scale(1.05);
            z-index: 10;
        }
        .element:active {
            cursor: grabbing;
            z-index: 50;
        }
        #crafting-zone {
            border: 3px dashed #4b5563;
            background-image: radial-gradient(#4b5563 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .discovered-element {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
    </style>
</head>
<body class="bg-gray-900 text-white h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-gray-800 shadow-lg p-4 flex justify-between items-center">
        <h1 class="text-3xl font-black tracking-wider">
            <span class="text-yellow-400">Ultra</span><span class="text-blue-400">craft</span>
        </h1>
        <div class="flex items-center gap-4">
            <button id="cheat-btn" class="bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-bold py-2 px-4 rounded-lg transition-colors">Cheat Sheet</button>
            <button id="reset-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">Reset Canvas</button>
        </div>
    </header>

    <!-- Main Game Area -->
    <div class="flex-grow grid grid-cols-1 md:grid-cols-4 gap-4 p-4 overflow-hidden">
        
        <!-- Discovered Elements Panel -->
        <div class="bg-gray-800 rounded-lg shadow-xl p-4 flex flex-col overflow-hidden">
            <h2 class="text-xl font-bold mb-4 text-center">Discovered Elements</h2>
            <div id="bonus-container" class="mb-4 text-center">
                 <button id="bonus-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">Unlock Bonus Elements âœ¨</button>
            </div>
            <div id="elements-panel" class="flex-grow overflow-y-auto grid grid-cols-3 sm:grid-cols-4 gap-2 pr-2 justify-items-center">
                <!-- Initial elements will be added here -->
            </div>
        </div>

        <!-- Crafting Zone -->
        <div class="md:col-span-3 bg-gray-800 rounded-lg shadow-xl flex flex-col items-center justify-center p-4 relative overflow-hidden">
            <div id="crafting-zone" class="w-full h-full rounded-lg relative">
                <p id="crafting-placeholder" class="text-gray-500 text-2xl font-semibold text-center absolute inset-0 flex items-center justify-center">Drag elements here to begin!</p>
                <!-- Dropped elements appear here -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 shadow-lg p-3 text-center">
        <p id="unlocked-count" class="text-lg font-bold text-yellow-400">Items Unlocked: 2</p>
    </footer>

    <!-- Password Modal -->
    <div id="password-modal" class="modal-overlay hidden">
        <div class="bg-gray-800 p-8 rounded-lg shadow-2xl w-full max-w-sm">
            <h2 class="text-2xl font-bold mb-4">Enter Password</h2>
            <p class="text-gray-400 mb-4">Enter the password to view the cheat sheet.</p>
            <form id="password-form">
                <input type="password" id="password-input" class="w-full bg-gray-700 text-white p-3 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                <p id="error-message" class="text-red-500 text-sm mb-4 hidden">Incorrect password. Please try again.</p>
                <div class="flex justify-end gap-4">
                    <button type="button" id="cancel-password" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg">Cancel</button>
                    <button type="submit" class="bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-bold py-2 px-4 rounded-lg">Submit</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Cheat Sheet Modal -->
    <div id="cheat-sheet-modal" class="modal-overlay hidden">
        <div class="bg-gray-800 p-8 rounded-lg shadow-2xl w-full max-w-2xl h-3/4 flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">Recipe Cheat Sheet</h2>
                <button id="close-cheat-sheet" class="text-2xl font-bold">&times;</button>
            </div>
            <div id="cheat-sheet-content" class="flex-grow overflow-y-auto bg-gray-900 p-4 rounded-lg text-lg">
                <!-- Recipes will be injected here -->
            </div>
        </div>
    </div>


    <script>
        const elements = {
            'Sun': 'â˜€ï¸', 'Water': 'ğŸ’§', 'Fire': 'ğŸ”¥', 'Earth': 'ğŸŒ', 'Wind': 'ğŸ’¨', 'Steam': 'ğŸ’¨', 'Plant': 'ğŸŒ±',
            'Tree': 'ğŸŒ³', 'Forest': 'ğŸŒ²', 'Swamp': 'ğŸŠ', 'Energy': 'âš¡', 'Lava': 'ğŸŒ‹', 'Obsidian': 'ğŸ—¿', 'Stone': 'ğŸª¨',
            'Sand': 'ğŸ–ï¸', 'Glass': 'ğŸ¥ƒ', 'Time': 'â³', 'Dinosaur': 'ğŸ¦–', 'Fossil': 'ğŸ¦´', 'Oil': 'ğŸ›¢ï¸', 'Car': 'ğŸš—',
            'Electricity': 'ğŸ’¡', 'Lightbulb': 'ğŸ’¡', 'Life': 'ğŸ§¬', 'Human': 'ğŸ§‘', 'Farmer': 'ğŸ§‘â€ğŸŒ¾', 'Field': 'ğŸŒ¾',
            'Wheat': 'ğŸŒ¾', 'Bread': 'ğŸ', 'House': 'ğŸ ', 'Village': 'ğŸ˜ï¸', 'City': 'ğŸ™ï¸', 'Metal': 'ğŸ”©', 'Tool': 'ğŸ”§',
            'Weapon': 'âš”ï¸', 'Knight': 'ğŸ›¡ï¸', 'Castle': 'ğŸ°', 'King': 'ğŸ‘‘', 'Story': 'ğŸ“–', 'Book': 'ğŸ“š', 'Library': 'ğŸ›ï¸',
            'Science': 'ğŸ”¬', 'Scientist': 'ğŸ§‘â€ğŸ”¬', 'Computer': 'ğŸ’»', 'Internet': 'ğŸŒ', 'Game': 'ğŸ®', 'Cloud': 'â˜ï¸',
            'Rain': 'ğŸŒ§ï¸', 'Rainbow': 'ğŸŒˆ', 'Unicorn': 'ğŸ¦„', 'Flower': 'ğŸŒ¸', 'Garden': 'ğŸ¡', 'Love': 'â¤ï¸', 'Family': 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦',
            'Wood': 'ğŸªµ', 'Boat': 'â›µ', 'Ship': 'ğŸš¢', 'Pirate': 'ğŸ´â€â˜ ï¸', 'Treasure': 'ğŸ’', 'Gold': 'ğŸ’°', 'Money': 'ğŸ’µ',
            'Bank': 'ğŸ¦', 'Moon': 'ğŸŒ™', 'Star': 'â­', 'Galaxy': 'ğŸŒŒ', 'Space': 'ğŸš€', 'Alien': 'ğŸ‘½', 'Planet': 'ğŸª',
            'Bird': 'ğŸ¦', 'Egg': 'ğŸ¥š', 'Philosophy': 'ğŸ¤”', 'Diamond': 'ğŸ’', 'Pressure': 'ğŸ§±', 'Coal': 'ğŸª¨',
            'Mountain': 'â›°ï¸', 'Volcano': 'ğŸŒ‹', 'Ash': 'ğŸŒ«ï¸', 'Phoenix': 'ğŸ”¥', 'Myth': 'ğŸ“œ', 'Dragon': 'ğŸ‰',
            'Lizard': 'ğŸ¦', 'Animal': 'ğŸ¾', 'Fish': 'ğŸŸ', 'Sushi': 'ğŸ£', 'Seaweed': 'ğŸŒ¿', 'Ocean': 'ğŸŒŠ', 'Salt': 'ğŸ§‚',
            'Food': 'ğŸ”', 'Recipe': 'ğŸ“œ', 'Chef': 'ğŸ§‘â€ğŸ³', 'Restaurant': 'ğŸ½ï¸', 'Brick': 'ğŸ§±', 'Wall': 'ğŸ§±', 'Sky': 'ğŸŒŒ', 'Prism': 'ğŸ’'
        };

        const recipes = {
            'Sun,Water': 'Rainbow', 'Water,Fire': 'Steam', 'Earth,Water': 'Plant', 'Plant,Plant': 'Tree',
            'Tree,Tree': 'Forest', 'Earth,Fire': 'Lava', 'Lava,Water': 'Obsidian', 'Steam,Earth': 'Swamp',
            'Fire,Stone': 'Metal', 'Stone,Water': 'Sand', 'Sand,Fire': 'Glass', 'Plant,Time': 'Fossil',
            'Fossil,Earth': 'Oil', 'Oil,Car': 'Gasoline', 'Metal,Tool': 'Weapon', 'Human,Stone': 'Tool',
            'Human,Human': 'Love', 'Love,Human': 'Family', 'Human,Weapon': 'Knight', 'Knight,House': 'Castle',
            'Castle,Human': 'King', 'King,Story': 'Myth', 'Human,Plant': 'Farmer', 'Farmer,Earth': 'Field',
            'Field,Plant': 'Wheat', 'Wheat,Fire': 'Bread', 'Human,Bread': 'Food', 'Human,House': 'Family',
            'House,House': 'Village', 'Village,Village': 'City', 'Fire,Wind': 'Energy', 'Energy,Metal': 'Electricity',
            'Electricity,Glass': 'Lightbulb', 'Swamp,Life': 'Lizard', 'Lizard,Time': 'Dinosaur', 'Dinosaur,Earth': 'Fossil',
            'Human,Life': 'Scientist', 'Scientist,Book': 'Science', 'Science,Human': 'Computer', 'Computer,Computer': 'Internet',
            'Internet,Human': 'Game', 'Water,Wind': 'Rain', 'Rain,Sun': 'Rainbow', 'Rainbow,Life': 'Unicorn',
            'Plant,Sun': 'Flower', 'Flower,Garden': 'Love', 'Wood,Water': 'Boat', 'Boat,Wind': 'Ship',
            'Ship,Human': 'Pirate', 'Pirate,Map': 'Treasure', 'Treasure,Earth': 'Gold', 'Gold,Human': 'Money',
            'Money,House': 'Bank', 'Sky,Fire': 'Sun', 'Sky,Stone': 'Moon', 'Moon,Sky': 'Star', 'Star,Star': 'Galaxy',
            'Galaxy,Science': 'Space', 'Space,Life': 'Alien', 'Planet,Life': 'Life', 'Human,Fire': 'Chef',
            'Earth,Earth': 'Mountain', 'Mountain,Fire': 'Volcano', 'Volcano,Water': 'Steam', 'Volcano,Wind': 'Ash',
            'Ash,Life': 'Phoenix', 'Phoenix,Story': 'Myth', 'Myth,Lizard': 'Dragon', 'Water,Water': 'Ocean',
            'Ocean,Sun': 'Salt', 'Fish,Fire': 'Sushi', 'Sushi,Plant': 'Seaweed', 'Stone,Stone': 'Wall',
            'Wall,House': 'City', 'Human,Stone': 'House', 'Earth,Pressure': 'Coal', 'Coal,Pressure': 'Diamond',
            'Human,Egg': 'Philosophy', 'Sky,Life': 'Bird', 'Bird,Bird': 'Egg', 'Life,Ocean': 'Fish',
            'Human,Fish': 'Food', 'Chef,Food': 'Restaurant', 'Restaurant,City': 'Michelin Star', 'Human,Book': 'Story',
            'Book,Book': 'Library', 'Rainbow,Glass': 'Prism', 'Rainbow,Earth': 'Flower'
        };

        let discovered = new Set(['Water', 'Earth']);
        const elementsPanel = document.getElementById('elements-panel');
        const craftingZone = document.getElementById('crafting-zone');
        const unlockedCount = document.getElementById('unlocked-count');
        const craftingPlaceholder = document.getElementById('crafting-placeholder');
        const resetBtn = document.getElementById('reset-btn');
        const cheatBtn = document.getElementById('cheat-btn');
        const bonusBtn = document.getElementById('bonus-btn');
        const passwordModal = document.getElementById('password-modal');
        const passwordForm = document.getElementById('password-form');
        const passwordInput = document.getElementById('password-input');
        const cancelPasswordBtn = document.getElementById('cancel-password');
        const errorMessage = document.getElementById('error-message');
        const cheatSheetModal = document.getElementById('cheat-sheet-modal');
        const closeCheatSheetBtn = document.getElementById('close-cheat-sheet');
        const cheatSheetContent = document.getElementById('cheat-sheet-content');

        let draggedElement = null;
        let isCombining = false;
        let elementLevels = {};

        // --- Sound Synthesis ---
        const newDiscoverySynth = new Tone.PolySynth(Tone.Synth, { oscillator: { type: "fatsawtooth" }, envelope: { attack: 0.01, decay: 0.2, sustain: 0.2, release: 0.3 } }).toDestination();
        const existingSynth = new Tone.MembraneSynth({ pitchDecay: 0.01, octaves: 2, envelope: { attack: 0.001, decay: 0.2, sustain: 0.01, release: 0.1 } }).toDestination();

        function playSound(type) {
            if (Tone.context.state !== 'running') { Tone.start(); }
            if (type === 'new') newDiscoverySynth.triggerAttackRelease(["C4", "E4", "G4", "C5"], "8n", Tone.now());
            if (type === 'existing') existingSynth.triggerAttackRelease("C2", "8n", Tone.now());
        }

        // --- Element Creation ---
        function createDraggableElement(name, isCraftingZone) {
            const el = document.createElement('div');
            el.className = 'element bg-gray-700 p-2 rounded-lg text-center';
            el.dataset.element = name;
            el.innerHTML = `<span class="text-3xl">${elements[name] || 'âœ¨'}</span><p class="text-sm truncate">${name}</p>`;
            
            if (isCraftingZone) {
                el.classList.add('crafting-element');
                el.addEventListener('mousedown', startDragInZone);
                el.addEventListener('touchstart', startDragInZone);
            } else {
                el.classList.add('sidebar-element', 'discovered-element');
                el.draggable = true;
                el.addEventListener('dragstart', (e) => e.dataTransfer.setData('text/plain', e.target.dataset.element));
            }
            return el;
        }

        function updateDiscoveredPanel() {
            const sortedDiscovered = Array.from(discovered).sort();
            elementsPanel.innerHTML = '';
            sortedDiscovered.forEach(name => elementsPanel.appendChild(createDraggableElement(name, false)));
            unlockedCount.textContent = `Items Unlocked: ${discovered.size}`;
        }

        // --- Drag and Drop Logic ---
        craftingZone.addEventListener('dragover', (e) => e.preventDefault());
        craftingZone.addEventListener('drop', (e) => {
            e.preventDefault();
            const elementName = e.dataTransfer.getData('text/plain');
            if (!elementName) return;

            craftingPlaceholder.style.display = 'none';
            const el = createDraggableElement(elementName, true);
            const rect = craftingZone.getBoundingClientRect();
            el.style.left = `${e.clientX - rect.left - 45}px`;
            el.style.top = `${e.clientY - rect.top - 45}px`;
            craftingZone.appendChild(el);
        });

        // --- In-Zone Dragging ---
        function startDragInZone(e) {
            draggedElement = e.target.closest('.crafting-element');
            draggedElement.style.zIndex = 100;
            const event = e.type === 'touchstart' ? e.touches[0] : e;
            const offsetX = event.clientX - draggedElement.getBoundingClientRect().left;
            const offsetY = event.clientY - draggedElement.getBoundingClientRect().top;

            function onMove(e) {
                if (!draggedElement) return;
                const moveEvent = e.type === 'touchmove' ? e.touches[0] : e;
                const rect = craftingZone.getBoundingClientRect();
                let x = moveEvent.clientX - rect.left - offsetX;
                let y = moveEvent.clientY - rect.top - offsetY;

                x = Math.max(0, Math.min(x, rect.width - draggedElement.offsetWidth));
                y = Math.max(0, Math.min(y, rect.height - draggedElement.offsetHeight));

                draggedElement.style.left = `${x}px`;
                draggedElement.style.top = `${y}px`;
                checkOverlap();
            }

            function onEnd() {
                if (draggedElement) {
                    draggedElement.style.zIndex = 10;
                    draggedElement = null;
                }
                document.removeEventListener('mousemove', onMove);
                document.removeEventListener('mouseup', onEnd);
                document.removeEventListener('touchmove', onMove);
                document.removeEventListener('touchend', onEnd);
            }

            document.addEventListener('mousemove', onMove);
            document.addEventListener('mouseup', onEnd);
            document.addEventListener('touchmove', onMove);
            document.addEventListener('touchend', onEnd);
        }

        // --- Combination Logic ---
        function checkOverlap() {
            if (isCombining) return;
            const elementsInZone = Array.from(craftingZone.querySelectorAll('.crafting-element'));
            if (elementsInZone.length < 2) return;

            for (let i = 0; i < elementsInZone.length; i++) {
                for (let j = i + 1; j < elementsInZone.length; j++) {
                    const el1 = elementsInZone[i];
                    const el2 = elementsInZone[j];
                    const rect1 = el1.getBoundingClientRect();
                    const rect2 = el2.getBoundingClientRect();

                    if (!(rect1.right < rect2.left || rect1.left > rect2.right || rect1.bottom < rect2.top || rect1.top > rect2.bottom)) {
                        attemptCombination(el1, el2);
                        return;
                    }
                }
            }
        }

        function attemptCombination(el1, el2) {
            isCombining = true;

            const name1 = el1.dataset.element;
            const name2 = el2.dataset.element;
            const key1 = `${name1},${name2}`;
            const key2 = `${name2},${name1}`;

            let newElementName = recipes[key1] || recipes[key2];
            let isNewDiscovery = false;

            if (!newElementName) {
                const level1 = elementLevels[name1] || 0;
                const level2 = elementLevels[name2] || 0;
                newElementName = level1 >= level2 ? name1 : name2;
            }
            
            if (!discovered.has(newElementName)) {
                isNewDiscovery = true;
                discovered.add(newElementName);
                updateDiscoveredPanel();
            }

            playSound(isNewDiscovery ? 'new' : 'existing');
            
            const midX = (el1.offsetLeft + el2.offsetLeft) / 2;
            const midY = (el1.offsetTop + el2.offsetTop) / 2;

            el1.remove();
            el2.remove();

            const newEl = createDraggableElement(newElementName, true);
            newEl.style.left = `${midX}px`;
            newEl.style.top = `${midY}px`;
            newEl.style.animation = 'fadeIn 0.3s';
            craftingZone.appendChild(newEl);
            
            if (craftingZone.querySelectorAll('.crafting-element').length === 0) {
                craftingPlaceholder.style.display = 'block';
            }

            setTimeout(() => { isCombining = false; }, 300);
        }
        
        // --- Calculate Element Levels for "Stronger" Logic ---
        function calculateElementLevels() {
            elementLevels = { 'Sun': 0, 'Water': 0, 'Fire': 0, 'Earth': 0 };
            let changed = true;
            while(changed) {
                changed = false;
                for (const key in recipes) {
                    const [el1, el2] = key.split(',');
                    const result = recipes[key];
                    if (elementLevels.hasOwnProperty(el1) && elementLevels.hasOwnProperty(el2)) {
                        const newLevel = Math.max(elementLevels[el1], elementLevels[el2]) + 1;
                        if (!elementLevels.hasOwnProperty(result) || elementLevels[result] > newLevel) {
                            elementLevels[result] = newLevel;
                            changed = true;
                        }
                    }
                }
            }
        }

        // --- Cheat Sheet and Modal Logic ---
        cheatBtn.addEventListener('click', () => {
            passwordModal.classList.remove('hidden');
            passwordInput.focus();
        });

        cancelPasswordBtn.addEventListener('click', () => {
            passwordModal.classList.add('hidden');
            errorMessage.classList.add('hidden');
            passwordInput.value = '';
        });

        passwordForm.addEventListener('submit', (e) => {
            e.preventDefault();
            if (passwordInput.value === 'Shashwat@321') {
                passwordModal.classList.add('hidden');
                passwordInput.value = '';
                errorMessage.classList.add('hidden');
                generateCheatSheet();
                cheatSheetModal.classList.remove('hidden');
            } else {
                errorMessage.classList.remove('hidden');
            }
        });

        closeCheatSheetBtn.addEventListener('click', () => {
            cheatSheetModal.classList.add('hidden');
        });

        function generateCheatSheet() {
            let content = '<div class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-2">';
            for (const key in recipes) {
                const [el1, el2] = key.split(',');
                const result = recipes[key];
                content += `<div>
                    <span class="text-xl">${elements[el1]}</span> ${el1} + <span class="text-xl">${elements[el2]}</span> ${el2} = <span class="text-xl">${elements[result]}</span> <span class="font-bold text-yellow-400">${result}</span>
                </div>`;
            }
            content += '</div>';
            cheatSheetContent.innerHTML = content;
        }

        // --- Reset Button ---
        resetBtn.addEventListener('click', () => {
            craftingZone.innerHTML = '';
            craftingPlaceholder.style.display = 'block';
        });
        
        // --- Bonus Button ---
        bonusBtn.addEventListener('click', () => {
            discovered.add('Fire');
            discovered.add('Sun');
            updateDiscoveredPanel();
            bonusBtn.remove(); // Remove the button after it's clicked
        });

        // --- Initial Load ---
        calculateElementLevels();
        updateDiscoveredPanel();
    </script>
</body>
</html>
